```{r}
library(DESeq2)


```


```{r}
embryonic_data = read.csv("embryonic.rna.seq.count.txt", sep = "\t",
                          stringsAsFactors = FALSE)
head(embryonic_data)
```

Calculate the differential expression between 2 successive time points: E12/E11, E13/E12, E14/E13
============================================================================================
Calculate differential expression of E12 vs E11
============================================================================================

First, extract the E11-E12 read counts

```{r}
e11_e12_count_table = embryonic_data[, 1:10]
head(e11_e12_count_table)
```

```{r}
stage = c(rep("E11", 5), rep("E12", 5))
meta_data_E11_E12 = data.frame(stage)
row.names(meta_data_E11_E12) = colnames(e11_e12_count_table)
meta_data_E11_E12
```

Create DESeq object
```{r}
deseq_data_e12_e11 = DESeqDataSetFromMatrix(countData = e11_e12_count_table,
                                    colData = meta_data_E11_E12,
                                    design = ~stage)
```

Filter out genes with low counts. Only keep those with a sum of read count across all samples that are greater than 10.

```{r}
deseq_data_e12_e11 = deseq_data_e12_e11[rowSums(counts(deseq_data_e12_e11))>10, ]
```

Calculate differential expression and shrink the log fold change

```{r}
dde_e12_e11 = DESeq(deseq_data_e12_e11)
res_e12_e11 = results(dde_e12_e11, contrast = c("stage", "E12", "E11"))
res_e12_e11 = lfcShrink(dde_e12_e11, contrast = c("stage", "E12", "E11"), res = res_e12_e11)
```

extract the data and subset for differentially expressed genes

```{r}
res.all_e12_e11 = data.frame(res_e12_e11)
res.sig_e12_e11 = subset(res.all_e12_e11, padj < 0.05)
```

Write data to file
```{r}
write.csv(res.sig_e12_e11, "e12_e11_sig_genes.txt")
```

============================================================================================
Calculate differential expression between E13 vs E12
============================================================================================

```{r}
e13_e12_count_table = embryonic_data[, 6:20]
head(e13_e12_count_table)
```



                                     